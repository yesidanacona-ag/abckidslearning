<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="La mejor app del mundo para aprender tablas de multiplicar - Divertida, adaptativa e inteligente">
    <meta name="theme-color" content="#6366f1">
    <title>Multiplicar MÃ¡gico - Aprende Jugando</title>
    <!-- Google Fonts: Fuentes amigables para niÃ±os -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;500;600;700&family=Nunito:wght@400;600;700;800&family=Poppins:wght@800;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
    <link rel="manifest" href="manifest.json">
    <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>âœ¨</text></svg>">
</head>
<body>
    <!-- Pantalla de Bienvenida -->
    <div id="welcomeScreen" class="screen active" role="main" aria-label="Pantalla de bienvenida">
        <div class="welcome-container">
            <div class="logo-container">
                <div class="magic-star">âœ¨</div>
                <h1 class="title-main">Multiplicar MÃ¡gico</h1>
                <div class="magic-star">âœ¨</div>
            </div>
            <p class="subtitle">Â¡La aventura mÃ¡s divertida para aprender las tablas de multiplicar!</p>

            <div class="welcome-form">
                <div class="input-group">
                    <label for="playerName">Â¿CÃ³mo te llamas?</label>
                    <input type="text" id="playerName" placeholder="Tu nombre..." maxlength="15" aria-label="Ingresa tu nombre" aria-required="true">
                </div>

                <div class="avatar-selector">
                    <label id="avatar-label">Elige tu avatar:</label>
                    <div class="avatar-tabs" role="tablist" aria-labelledby="avatar-label">
                        <button class="avatar-tab active" data-category="personajes" role="tab" aria-selected="true" aria-controls="avatarGrid">ğŸ‘¥ Personajes</button>
                        <button class="avatar-tab" data-category="animales" role="tab" aria-selected="false" aria-controls="avatarGrid">ğŸ¾ Animales</button>
                        <button class="avatar-tab" data-category="fantasÃ­a" role="tab" aria-selected="false" aria-controls="avatarGrid">âœ¨ FantasÃ­a</button>
                        <button class="avatar-tab" data-category="deportes" role="tab" aria-selected="false" aria-controls="avatarGrid">âš½ Deportes</button>
                    </div>
                    <div class="avatar-grid" id="avatarGrid">
                        <!-- Personajes -->
                        <div class="avatar-option" data-avatar="ğŸ¦¸â€â™‚ï¸" data-category="personajes">ğŸ¦¸â€â™‚ï¸</div>
                        <div class="avatar-option" data-avatar="ğŸ¦¸â€â™€ï¸" data-category="personajes">ğŸ¦¸â€â™€ï¸</div>
                        <div class="avatar-option" data-avatar="ğŸ§™â€â™‚ï¸" data-category="personajes">ğŸ§™â€â™‚ï¸</div>
                        <div class="avatar-option" data-avatar="ğŸ§™â€â™€ï¸" data-category="personajes">ğŸ§™â€â™€ï¸</div>
                        <div class="avatar-option" data-avatar="ğŸ¤´" data-category="personajes">ğŸ¤´</div>
                        <div class="avatar-option" data-category="personajes" data-avatar="ğŸ‘¸">ğŸ‘¸</div>
                        <div class="avatar-option" data-avatar="ğŸ§‘â€ğŸš€" data-category="personajes">ğŸ§‘â€ğŸš€</div>
                        <div class="avatar-option" data-avatar="ğŸ¥·" data-category="personajes">ğŸ¥·</div>
                        <div class="avatar-option" data-avatar="ğŸ¤–" data-category="personajes">ğŸ¤–</div>
                        <div class="avatar-option" data-avatar="ğŸ‘¨â€ğŸ¤" data-category="personajes">ğŸ‘¨â€ğŸ¤</div>
                        <div class="avatar-option" data-avatar="ğŸ‘©â€ğŸ¤" data-category="personajes">ğŸ‘©â€ğŸ¤</div>
                        <div class="avatar-option" data-avatar="ğŸ§‘â€ğŸš’" data-category="personajes">ğŸ§‘â€ğŸš’</div>

                        <!-- Animales -->
                        <div class="avatar-option" data-avatar="ğŸ±" data-category="animales">ğŸ±</div>
                        <div class="avatar-option" data-avatar="ğŸ¶" data-category="animales">ğŸ¶</div>
                        <div class="avatar-option" data-avatar="ğŸ¼" data-category="animales">ğŸ¼</div>
                        <div class="avatar-option" data-avatar="ğŸ¨" data-category="animales">ğŸ¨</div>
                        <div class="avatar-option" data-avatar="ğŸ¦Š" data-category="animales">ğŸ¦Š</div>
                        <div class="avatar-option" data-avatar="ğŸ¦" data-category="animales">ğŸ¦</div>
                        <div class="avatar-option" data-avatar="ğŸ¯" data-category="animales">ğŸ¯</div>
                        <div class="avatar-option" data-avatar="ğŸ®" data-category="animales">ğŸ®</div>
                        <div class="avatar-option" data-avatar="ğŸ·" data-category="animales">ğŸ·</div>
                        <div class="avatar-option" data-avatar="ğŸ¸" data-category="animales">ğŸ¸</div>
                        <div class="avatar-option" data-avatar="ğŸ°" data-category="animales">ğŸ°</div>
                        <div class="avatar-option" data-avatar="ğŸ™" data-category="animales">ğŸ™</div>
                        <div class="avatar-option" data-avatar="ğŸ¦„" data-category="animales">ğŸ¦„</div>
                        <div class="avatar-option" data-avatar="ğŸ§" data-category="animales">ğŸ§</div>

                        <!-- FantasÃ­a -->
                        <div class="avatar-option" data-avatar="ğŸ‰" data-category="fantasÃ­a">ğŸ‰</div>
                        <div class="avatar-option" data-avatar="ğŸ¦„" data-category="fantasÃ­a">ğŸ¦„</div>
                        <div class="avatar-option" data-avatar="ğŸš€" data-category="fantasÃ­a">ğŸš€</div>
                        <div class="avatar-option" data-avatar="âš¡" data-category="fantasÃ­a">âš¡</div>
                        <div class="avatar-option" data-avatar="ğŸŒŸ" data-category="fantasÃ­a">ğŸŒŸ</div>
                        <div class="avatar-option" data-avatar="ğŸ’«" data-category="fantasÃ­a">ğŸ’«</div>
                        <div class="avatar-option" data-avatar="ğŸ”¥" data-category="fantasÃ­a">ğŸ”¥</div>
                        <div class="avatar-option" data-avatar="â„ï¸" data-category="fantasÃ­a">â„ï¸</div>
                        <div class="avatar-option" data-avatar="ğŸŒˆ" data-category="fantasÃ­a">ğŸŒˆ</div>
                        <div class="avatar-option" data-avatar="ğŸ‘½" data-category="fantasÃ­a">ğŸ‘½</div>
                        <div class="avatar-option" data-avatar="ğŸ›¸" data-category="fantasÃ­a">ğŸ›¸</div>
                        <div class="avatar-option" data-avatar="ğŸª" data-category="fantasÃ­a">ğŸª</div>

                        <!-- Deportes -->
                        <div class="avatar-option" data-avatar="âš½" data-category="deportes">âš½</div>
                        <div class="avatar-option" data-avatar="ğŸ€" data-category="deportes">ğŸ€</div>
                        <div class="avatar-option" data-avatar="ğŸ¾" data-category="deportes">ğŸ¾</div>
                        <div class="avatar-option" data-avatar="ğŸˆ" data-category="deportes">ğŸˆ</div>
                        <div class="avatar-option" data-avatar="âš¾" data-category="deportes">âš¾</div>
                        <div class="avatar-option" data-avatar="ğŸ" data-category="deportes">ğŸ</div>
                        <div class="avatar-option" data-avatar="ğŸ³" data-category="deportes">ğŸ³</div>
                        <div class="avatar-option" data-avatar="ğŸ¯" data-category="deportes">ğŸ¯</div>
                        <div class="avatar-option" data-avatar="ğŸ®" data-category="deportes">ğŸ®</div>
                        <div class="avatar-option" data-avatar="ğŸ¨" data-category="deportes">ğŸ¨</div>
                        <div class="avatar-option" data-avatar="ğŸ¸" data-category="deportes">ğŸ¸</div>
                        <div class="avatar-option" data-avatar="ğŸº" data-category="deportes">ğŸº</div>
                    </div>
                </div>

                <button class="btn-primary" id="startAdventure" aria-label="Comenzar la aventura de aprendizaje">Â¡Comenzar Aventura!</button>
            </div>
        </div>
    </div>

    <!-- Pantalla Principal -->
    <div id="mainScreen" class="screen" role="main" aria-label="MenÃº principal del juego">
        <header class="main-header" role="banner">
            <div class="player-info" aria-label="InformaciÃ³n del jugador">
                <div class="player-avatar" id="playerAvatar">ğŸ¦¸</div>
                <div class="player-details">
                    <div class="player-name" id="headerPlayerName">Jugador</div>
                    <div class="player-mastery">
                        <span class="mastery-badge">â­ <span id="playerStars">0</span> de 45 estrellas</span>
                        <div class="stars-visual" id="starsVisual">
                            <!-- Estrellas visuales generadas dinÃ¡micamente -->
                            â­â­â­â­â­
                        </div>
                    </div>
                </div>
            </div>
            <div class="player-stats" role="status" aria-label="EstadÃ­sticas del jugador">
                <div class="stat" aria-label="Estrellas totales">
                    <span class="stat-icon" aria-hidden="true">â­</span>
                    <span id="totalStars">0</span>
                </div>
                <div class="stat" aria-label="Medallas totales">
                    <span class="stat-icon" aria-hidden="true">ğŸ†</span>
                    <span id="totalMedals">0</span>
                </div>
                <div class="stat" aria-label="Racha actual">
                    <span class="stat-icon" aria-hidden="true">ğŸ”¥</span>
                    <span id="streak">0</span>
                </div>
            </div>
        </header>

        <div class="main-content">
            <!-- BotÃ³n CTA Principal -->
            <div class="cta-main-container">
                <button class="cta-main" id="ctaStartLearning">
                    ğŸš€ Â¡EMPEZAR A APRENDER!
                </button>
                <p class="cta-subtitle">Descubre las tablas de multiplicar con trucos mÃ¡gicos</p>
            </div>

            <div class="game-modes" role="navigation" aria-label="Modos de juego">
                <div class="mode-card" id="practiceMode" role="button" tabindex="0" aria-label="Modo Aprender Tablas: Aprende a tu propio ritmo sin presiÃ³n de tiempo">
                    <div class="mode-icon" aria-hidden="true">ğŸ“š</div>
                    <h3>Â¡Aprender Tablas!</h3>
                    <p>TÃº controlas el tiempo</p>
                    <div class="mode-badge" aria-hidden="true">ğŸŒ Relajado</div>
                </div>

                <div class="mode-card" id="challengeMode" role="button" tabindex="0" aria-label="Modo RÃ¡pido como un Rayo: Responde todas las multiplicaciones que puedas en 1 minuto">
                    <div class="mode-icon" aria-hidden="true">âš¡</div>
                    <h3>Â¡RÃ¡pido como un Rayo!</h3>
                    <p>Â¿CuÃ¡ntas sabes en 1 minuto?</p>
                    <div class="mode-badge" aria-hidden="true">ğŸš€ Emocionante</div>
                </div>

                <div class="mode-card" id="speedDrillMode" role="button" tabindex="0" aria-label="Modo Taladro RÃ¡pido: Escribe la respuesta directamente sin opciones mÃºltiples">
                    <div class="mode-icon" aria-hidden="true">âš¡</div>
                    <h3>Taladro RÃ¡pido</h3>
                    <p>Escribe la respuesta sin opciones</p>
                    <div class="mode-badge hot" aria-hidden="true">Dominio Real</div>
                </div>

                <div class="mode-card" id="shipDefenseMode" role="button" tabindex="0" aria-label="Modo Defensa de la Nave: Identifica mÃºltiplos y protege tu nave espacial">
                    <div class="mode-icon" aria-hidden="true">ğŸ›¸</div>
                    <h3>Defensa de la Nave</h3>
                    <p>Identifica mÃºltiplos y protege tu nave</p>
                    <div class="mode-badge hot" aria-hidden="true">Pensar Diferente</div>
                </div>

                <div class="mode-card" id="factorChainMode" role="button" tabindex="0" aria-label="Modo Cadena de Factores: Resuelve puzzles descomponiendo nÃºmeros en factores primos">
                    <div class="mode-icon" aria-hidden="true">ğŸ§©</div>
                    <h3>Cadena de Factores</h3>
                    <p>DescompÃ³n nÃºmeros en factores primos</p>
                    <div class="mode-badge hot" aria-hidden="true">Puzzle</div>
                </div>

                <div class="mode-card" id="adventureMode" role="button" tabindex="0" aria-label="Modo Aventura Espacial: Viaja por el espacio resolviendo multiplicaciones en cada planeta">
                    <div class="mode-icon" aria-hidden="true">ğŸš€</div>
                    <h3>Aventura Espacial</h3>
                    <p>Viaja por el espacio resolviendo multiplicaciones</p>
                    <div class="mode-badge" aria-hidden="true">Ã‰pico</div>
                </div>

                <div class="mode-card" id="raceMode" role="button" tabindex="0" aria-label="Modo Carrera MatemÃ¡tica: Compite contra oponentes virtuales en una carrera de multiplicaciones">
                    <div class="mode-icon" aria-hidden="true">ğŸ</div>
                    <h3>Carrera MatemÃ¡tica</h3>
                    <p>Compite contra oponentes virtuales</p>
                    <div class="mode-badge" aria-hidden="true">Competitivo</div>
                </div>

                <div class="mode-card" id="bossMode" role="button" tabindex="0" aria-label="Modo Batalla de Jefes: Enfrenta jefes matemÃ¡ticos Ã©picos respondiendo multiplicaciones">
                    <div class="mode-icon" aria-hidden="true">ğŸ‘¾</div>
                    <h3>Batalla de Jefes</h3>
                    <p>Derrota a los jefes matemÃ¡ticos</p>
                    <div class="mode-badge" aria-hidden="true">DifÃ­cil</div>
                </div>

                <div class="mode-card" id="progressMode" role="button" tabindex="0" aria-label="Mis Logros: Revisa tus estadÃ­sticas y progreso de aprendizaje">
                    <div class="mode-icon" aria-hidden="true">ğŸ“Š</div>
                    <h3>Mis Logros</h3>
                    <p>Â¡Mira todo lo que has aprendido!</p>
                    <div class="mode-badge" aria-hidden="true">ğŸ† Logros</div>
                </div>

                <div class="mode-card" id="shopMode" role="button" tabindex="0" aria-label="Tienda MÃ¡gica: Compra avatares, naves y poderes especiales con tus monedas">
                    <div class="mode-icon" aria-hidden="true">ğŸ›’</div>
                    <h3>Tienda MÃ¡gica</h3>
                    <p>Compra avatares y poderes</p>
                    <div class="mode-badge" aria-hidden="true">âœ¨ Nuevo</div>
                </div>

                <div class="mode-card" id="missionsMode" role="button" tabindex="0" aria-label="Misiones del DÃ­a: Completa desafÃ­os diarios especiales para ganar recompensas">
                    <div class="mode-icon" aria-hidden="true">ğŸ¯</div>
                    <h3>Misiones del DÃ­a</h3>
                    <p>Completa desafÃ­os especiales</p>
                    <div class="mode-badge" aria-hidden="true">â­ Diario</div>
                </div>

                <div class="mode-card" id="grimorioMode" role="button" tabindex="0" aria-label="Libro de Trucos: Revisa tus trucos mnemotÃ©cnicos secretos para memorizar tablas">
                    <div class="mode-icon" aria-hidden="true">ğŸ“–</div>
                    <h3>Libro de Trucos</h3>
                    <p>Revisa tus trucos secretos</p>
                    <div class="mode-badge hot" aria-hidden="true">ğŸ§™â€â™‚ï¸ MÃ¡gico</div>
                </div>

                <div class="mode-card" id="advancedModesBtn" role="button" tabindex="0" aria-label="MÃ¡s Juegos: Descubre modos de juego avanzados adicionales">
                    <div class="mode-icon" aria-hidden="true">ğŸ®</div>
                    <h3>MÃ¡s Juegos</h3>
                    <p>Descubre mÃ¡s modos avanzados</p>
                    <div class="mode-badge hot" aria-hidden="true">ğŸš€ Avanzado</div>
                </div>

                <div class="mode-card hero-showcase-card" id="heroShowcaseMode" role="button" tabindex="0" aria-label="Escaparate del HÃ©roe: Muestra tu personaje personalizado y todos tus logros">
                    <div class="mode-icon" aria-hidden="true">ğŸ‘‘</div>
                    <h3>Escaparate del HÃ©roe</h3>
                    <p>Muestra tu personaje y logros</p>
                    <div class="mode-badge hot" aria-hidden="true">Ã‰pico</div>
                </div>
            </div>

            <!-- SecciÃ³n de Equipamiento -->
            <div class="equipment-section">
                <h2 class="equipment-title">ğŸ’ MI EQUIPAMIENTO</h2>
                <div class="equipment-grid">
                    <div class="equipment-slot">
                        <div class="equipment-label">Avatar</div>
                        <div class="equipment-icon" id="equippedAvatar">ğŸ¦¸</div>
                        <div class="equipment-name" id="equippedAvatarName">HÃ©roe</div>
                    </div>
                    <div class="equipment-slot">
                        <div class="equipment-label">Nave</div>
                        <div class="equipment-icon" id="equippedShip">ğŸš€</div>
                        <div class="equipment-name" id="equippedShipName">Cohete BÃ¡sico</div>
                    </div>
                    <div class="equipment-slot">
                        <div class="equipment-label">Auto</div>
                        <div class="equipment-icon" id="equippedCar">ğŸï¸</div>
                        <div class="equipment-name" id="equippedCarName">Auto de Carrera</div>
                    </div>
                    <div class="equipment-slot">
                        <div class="equipment-label">Arma</div>
                        <div class="equipment-icon" id="equippedWeapon">âš”ï¸</div>
                        <div class="equipment-name" id="equippedWeaponName">Espada</div>
                    </div>
                </div>
                <p class="equipment-hint">ğŸ’¡ Compra mÃ¡s items en la Tienda para personalizar tu personaje</p>
            </div>
        </div>
    </div>

    <!-- Pantalla de Modo PrÃ¡ctica Adaptativo -->
    <div id="practiceScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromPractice" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>Modo PrÃ¡ctica</h2>
            <div class="score-display" role="status" aria-live="polite" aria-label="PuntuaciÃ³n actual">Puntos: <span id="practiceScore">0</span></div>
        </div>

        <!-- Pantalla de DiagnÃ³stico (primera vez) -->
        <div class="diagnostic-screen hidden" id="diagnosticScreen">
            <div class="diagnostic-welcome">
                <h2>Â¡Hola! ğŸ‘‹</h2>
                <p class="diagnostic-subtitle">Antes de comenzar, vamos a ver quÃ© tablas ya conoces.</p>
                <p class="diagnostic-description">Son solo 15 preguntas rÃ¡pidas. Â¡No te preocupes si no sabes alguna!</p>
                <button class="btn-primary diagnostic-start-btn" id="startDiagnostic">
                    Comenzar EvaluaciÃ³n
                </button>
            </div>
        </div>

        <!-- Pantalla de Preguntas DiagnÃ³sticas -->
        <div class="diagnostic-quiz hidden" id="diagnosticQuiz">
            <div class="diagnostic-progress">
                <div class="diagnostic-progress-bar">
                    <div class="diagnostic-progress-fill" id="diagnosticProgressFill"></div>
                </div>
                <div class="diagnostic-progress-text">
                    Pregunta <span id="diagnosticQuestionNum">1</span> de 15
                </div>
            </div>

            <div class="diagnostic-question">
                <div class="diagnostic-timer">
                    <div class="timer-circle" id="diagnosticTimerCircle"></div>
                    <span id="diagnosticTimeLeft">10</span>s
                </div>
                <div class="question-text-large" id="diagnosticQuestion">2 Ã— 3 = ?</div>
            </div>

            <div class="diagnostic-options" id="diagnosticOptions">
                <!-- Opciones generadas dinÃ¡micamente -->
            </div>
        </div>

        <!-- Resultados del DiagnÃ³stico -->
        <div class="diagnostic-results hidden" id="diagnosticResults">
            <h2>ğŸ“Š Resultados de tu EvaluaciÃ³n</h2>
            <p class="results-subtitle">AquÃ­ estÃ¡ tu mapa de dominio:</p>
            <div id="diagnosticResultsContent">
                <!-- Contenido generado dinÃ¡micamente -->
            </div>
            <button class="btn-primary" id="continueToDomainMap">
                Ver Mi Mapa de Dominio
            </button>
        </div>

        <!-- Mapa de Dominio Visual -->
        <div class="domain-map hidden" id="domainMap">
            <div class="domain-header">
                <h2>ğŸ—ºï¸ Tu Mapa de MultiplicaciÃ³n</h2>
                <div class="overall-mastery">
                    <div class="mastery-circle" id="overallMasteryCircle">
                        <svg width="100" height="100">
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#333" stroke-width="10"/>
                            <circle cx="50" cy="50" r="45" fill="none" stroke="#10B981" stroke-width="10"
                                    stroke-dasharray="283" stroke-dashoffset="283" id="masteryCircleFill"/>
                        </svg>
                        <div class="mastery-percent" id="overallMasteryPercent">0%</div>
                    </div>
                    <div class="mastery-label">Dominio General</div>
                </div>
            </div>

            <div class="domain-legend">
                <div class="legend-item">
                    <span class="legend-dot mastered"></span>
                    <span class="legend-label">ğŸŸ¢ DOMINADAS (80%+)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot learning"></span>
                    <span class="legend-label">ğŸŸ¡ EN PROGRESO (50-79%)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-dot weak"></span>
                    <span class="legend-label">ğŸ”´ NECESITAN PRÃCTICA (0-49%)</span>
                </div>
            </div>

            <div class="tables-by-level">
                <div class="level-section mastered-section">
                    <h3 class="level-title">ğŸŸ¢ DOMINADAS</h3>
                    <div class="tables-grid-mastery" id="masteredTables">
                        <!-- Tablas dominadas -->
                    </div>
                </div>

                <div class="level-section learning-section">
                    <h3 class="level-title">ğŸŸ¡ EN PROGRESO</h3>
                    <div class="tables-grid-mastery" id="learningTables">
                        <!-- Tablas en progreso -->
                    </div>
                </div>

                <div class="level-section weak-section">
                    <h3 class="level-title">ğŸ”´ NECESITAN PRÃCTICA</h3>
                    <div class="tables-grid-mastery" id="weakTables">
                        <!-- Tablas dÃ©biles -->
                    </div>
                </div>
            </div>

            <div class="domain-actions">
                <button class="btn-primary" id="practiceSuggested">
                    ğŸ¯ Practicar Recomendadas
                </button>
                <button class="btn-secondary" id="chooseCustomTables">
                    âœï¸ Elegir Mis Tablas
                </button>
            </div>
        </div>

        <!-- Selector de Tablas (modo custom) -->
        <div class="practice-setup hidden" id="practiceSetup">
            <h3>Selecciona las tablas para practicar:</h3>
            <div class="tables-grid-select">
                <button class="table-btn-select" data-table="2">
                    <div class="table-number">2</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="3">
                    <div class="table-number">3</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="4">
                    <div class="table-number">4</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="5">
                    <div class="table-number">5</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="6">
                    <div class="table-number">6</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="7">
                    <div class="table-number">7</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="8">
                    <div class="table-number">8</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="9">
                    <div class="table-number">9</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
                <button class="table-btn-select" data-table="10">
                    <div class="table-number">10</div>
                    <div class="table-mastery-mini">0%</div>
                    <div class="table-status-dot"></div>
                </button>
            </div>
            <div class="practice-setup-actions">
                <button class="btn-secondary" id="backToDomainMap">â† Volver al Mapa</button>
                <button class="btn-primary" id="startCustomPractice">Comenzar PrÃ¡ctica</button>
            </div>
        </div>

        <!-- Juego de PrÃ¡ctica -->
        <div class="practice-game hidden" id="practiceGame">
            <div class="question-container">
                <div class="progress-indicator">
                    <span>Pregunta <span id="questionNumber">1</span> de <span id="totalQuestions">10</span></span>
                </div>

                <div class="question-display">
                    <div class="question-text" id="questionText">5 Ã— 7 = ?</div>
                </div>

                <div class="answer-section">
                    <div class="answer-options" id="answerOptions">
                        <!-- Opciones generadas dinÃ¡micamente -->
                    </div>
                </div>

                <div class="feedback-container" id="feedbackContainer"></div>
            </div>

            <div class="practice-stats">
                <div class="mini-stat">
                    <div class="mini-stat-label">Correctas</div>
                    <div class="mini-stat-value correct" id="correctCount">0</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Incorrectas</div>
                    <div class="mini-stat-value incorrect" id="incorrectCount">0</div>
                </div>
                <div class="mini-stat">
                    <div class="mini-stat-label">Racha</div>
                    <div class="mini-stat-value streak" id="currentStreak">0</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de DesafÃ­o RÃ¡pido -->
    <div id="challengeScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromChallenge" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>DesafÃ­o RÃ¡pido</h2>
            <div class="timer-display">
                <span class="timer-icon">â±ï¸</span>
                <span id="challengeTimer">60</span>s
            </div>
        </div>

        <div class="challenge-game">
            <div class="challenge-score-big" id="challengeScoreBig">0</div>

            <!-- Combo Counter -->
            <div class="combo-counter hidden" id="comboCounter">
                <div class="combo-number" id="comboNumber">0</div>
                <div class="combo-label">COMBO</div>
                <div class="combo-multiplier" id="comboMultiplier">Ã—1</div>
            </div>

            <div class="question-container">
                <div class="question-display-large">
                    <div class="question-text-large" id="challengeQuestion">Â¡PrepÃ¡rate!</div>
                </div>

                <div class="answer-section">
                    <div class="answer-options-large" id="challengeOptions">
                        <!-- Opciones generadas dinÃ¡micamente -->
                    </div>
                </div>
            </div>

            <div class="challenge-stats-live">
                <div class="stat-item">
                    <span class="stat-label">Correctas:</span>
                    <span class="stat-value" id="challengeCorrect">0</span>
                </div>
                <div class="stat-item">
                    <span class="stat-label">Racha:</span>
                    <span class="stat-value" id="challengeStreak">0</span>
                </div>
            </div>
        </div>

        <button class="btn-primary hidden" id="startChallenge">Â¡Comenzar DesafÃ­o!</button>
    </div>

    <!-- Pantalla de Aventura Espacial -->
    <div id="adventureScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromAdventure" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>Aventura Espacial</h2>
            <div class="lives-display">
                <span id="livesContainer">â¤ï¸â¤ï¸â¤ï¸</span>
            </div>
        </div>

        <div class="adventure-game">
            <canvas id="spaceCanvas" width="800" height="600"></canvas>

            <!-- Instrucciones -->
            <div class="space-instructions">
                <p>ğŸ¯ Toca los asteroides con la respuesta correcta</p>
                <p>ğŸ’ Recoge power-ups para obtener ventajas</p>
            </div>
        </div>
    </div>

    <!-- Pantalla de Carrera MatemÃ¡tica -->
    <div id="raceScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromRace" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>Carrera MatemÃ¡tica</h2>
            <div class="race-progress-display">
                <span>Pregunta <span id="raceQuestionNum">1</span>/10</span>
            </div>
        </div>

        <div class="race-game">
            <!-- Pista de Carrera -->
            <div class="race-track">
                <div class="race-lane">
                    <div class="lane-label">
                        <span class="racer-avatar" id="playerRaceAvatar">ğŸ¦¸</span>
                        <span class="racer-name" id="playerRaceName">TÃº</span>
                    </div>
                    <div class="lane-progress">
                        <div class="lane-bar">
                            <div class="racer-position" id="playerRacePosition" style="left: 0%">
                                <span class="racer-icon">ğŸ¦¸</span>
                            </div>
                        </div>
                        <div class="finish-line">ğŸ</div>
                    </div>
                </div>

                <div class="race-lane">
                    <div class="lane-label">
                        <span class="racer-avatar">ğŸ°</span>
                        <span class="racer-name">Conejo RÃ¡pido</span>
                    </div>
                    <div class="lane-progress">
                        <div class="lane-bar">
                            <div class="racer-position" id="opponent1Position" style="left: 0%">
                                <span class="racer-icon">ğŸ°</span>
                            </div>
                        </div>
                        <div class="finish-line">ğŸ</div>
                    </div>
                </div>

                <div class="race-lane">
                    <div class="lane-label">
                        <span class="racer-avatar">ğŸ¢</span>
                        <span class="racer-name">Tortuga Sabia</span>
                    </div>
                    <div class="lane-progress">
                        <div class="lane-bar">
                            <div class="racer-position" id="opponent2Position" style="left: 0%">
                                <span class="racer-icon">ğŸ¢</span>
                            </div>
                        </div>
                        <div class="finish-line">ğŸ</div>
                    </div>
                </div>

                <div class="race-lane">
                    <div class="lane-label">
                        <span class="racer-avatar">ğŸ¦Š</span>
                        <span class="racer-name">Zorro Astuto</span>
                    </div>
                    <div class="lane-progress">
                        <div class="lane-bar">
                            <div class="racer-position" id="opponent3Position" style="left: 0%">
                                <span class="racer-icon">ğŸ¦Š</span>
                            </div>
                        </div>
                        <div class="finish-line">ğŸ</div>
                    </div>
                </div>
            </div>

            <!-- Ãrea de Pregunta -->
            <div class="race-question-area">
                <div class="race-question-display">
                    <div class="race-question-text" id="raceQuestion">Â¡PrepÃ¡rate!</div>
                </div>

                <div class="race-answer-section">
                    <div class="race-answer-options" id="raceAnswerOptions">
                        <!-- Generado dinÃ¡micamente -->
                    </div>
                </div>

                <div class="race-feedback" id="raceFeedback"></div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Batalla de Jefes -->
    <div id="bossScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromBoss" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>Batalla de Jefes</h2>
            <div class="boss-level-display">
                <span>Jefe <span id="currentBossNum">1</span>/10</span>
            </div>
        </div>

        <div class="boss-game">
            <!-- Contenedor del Motor de Batalla Ã‰pica -->
            <div id="bossGameContainer" class="boss-game-container">
                <!-- El BossGameEngine genera todo el contenido aquÃ­ -->
            </div>
        </div>
    </div>

    <!-- Pantalla de Progreso -->
    <div id="progressScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromProgress" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>ğŸŒŒ La Galaxia del Dominio</h2>
        </div>

        <div class="galaxy-content">
            <!-- Sistema Solar de las Tablas -->
            <div class="galaxy-section">
                <div class="galaxy-title-box">
                    <h3 class="galaxy-section-title">ğŸª SISTEMA SOLAR DE LAS TABLAS</h3>
                    <p class="galaxy-subtitle">Cada planeta representa una tabla. ExplÃ³ralas para dominarlas todas.</p>
                </div>
                <div class="galaxy-canvas-container">
                    <canvas id="galaxyCanvas" width="800" height="600"></canvas>
                    <div class="galaxy-legend">
                        <div class="legend-item"><span class="legend-dot asteroid"></span> Inexplorado (0-20%)</div>
                        <div class="legend-item"><span class="legend-dot young"></span> En Desarrollo (21-50%)</div>
                        <div class="legend-item"><span class="legend-dot vibrant"></span> En Progreso (51-90%)</div>
                        <div class="legend-item"><span class="legend-dot ringed"></span> Casi Dominado (91-99%)</div>
                        <div class="legend-item"><span class="legend-dot crystal"></span> Dominado (100%)</div>
                    </div>
                </div>
            </div>

            <!-- Nave Madre (Stats as "Honors") -->
            <div class="mother-ship-section">
                <div class="mother-ship-card">
                    <div class="mother-ship-header">
                        <div class="ship-icon">ğŸš€</div>
                        <h3>NAVE MADRE</h3>
                        <div class="ship-status">En Ã“rbita</div>
                    </div>
                    <div class="ship-honors">
                        <div class="honor-item">
                            <div class="honor-icon">â­</div>
                            <div class="honor-info">
                                <div class="honor-label">Estrellas Recolectadas</div>
                                <div class="honor-value" id="galaxyStars">0</div>
                            </div>
                        </div>
                        <div class="honor-item">
                            <div class="honor-icon">ğŸ†</div>
                            <div class="honor-info">
                                <div class="honor-label">Trofeos de Guerra</div>
                                <div class="honor-value" id="galaxyTrophies">0</div>
                            </div>
                        </div>
                        <div class="honor-item">
                            <div class="honor-icon">ğŸ“Š</div>
                            <div class="honor-info">
                                <div class="honor-label">Tasa de Victoria</div>
                                <div class="honor-value" id="galaxyAccuracy">0%</div>
                            </div>
                        </div>
                        <div class="honor-item">
                            <div class="honor-icon">ğŸ”¥</div>
                            <div class="honor-info">
                                <div class="honor-label">Racha de Fuego</div>
                                <div class="honor-value" id="galaxyStreak">0 dÃ­as</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SalÃ³n de Trofeos -->
            <div class="trophy-hall-section">
                <div class="galaxy-title-box">
                    <h3 class="galaxy-section-title">ğŸ† SALÃ“N DE TROFEOS</h3>
                    <p class="galaxy-subtitle">Trofeos forjados con sudor y victoria.</p>
                </div>
                <div class="trophy-hall">
                    <div class="trophy-pedestals" id="trophyPedestals">
                        <!-- Generado dinÃ¡micamente -->
                    </div>
                </div>
            </div>

            <!-- BotÃ­n de Guerra -->
            <div class="war-loot-section">
                <div class="galaxy-title-box">
                    <h3 class="galaxy-section-title">âš”ï¸ BOTÃN DE GUERRA</h3>
                    <p class="galaxy-subtitle">Medallas ganadas en el campo de batalla.</p>
                </div>
                <div class="war-loot-grid" id="warLootGrid">
                    <!-- Generado dinÃ¡micamente -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Datos de Planeta -->
    <div id="planetModal" class="modal galaxy-modal hidden">
        <div class="modal-content galaxy-modal-content">
            <button class="modal-close" id="planetModalClose">âœ•</button>
            <div class="planet-modal-header">
                <div class="planet-modal-icon" id="planetModalIcon">ğŸª</div>
                <h2 id="planetModalTitle">Planeta del 7</h2>
                <div class="planet-modal-status" id="planetModalStatus">
                    <span class="status-label">Estado:</span>
                    <span class="status-value" id="planetModalStatusText">Inexplorado (10%)</span>
                </div>
            </div>

            <div class="planet-modal-body">
                <div class="planet-intel-section">
                    <h3>ğŸ“Š DATOS DE INTELIGENCIA</h3>
                    <div class="intel-grid">
                        <div class="intel-item">
                            <div class="intel-label">Dominio Actual</div>
                            <div class="intel-value">
                                <div class="intel-bar">
                                    <div class="intel-bar-fill" id="planetModalProgress" style="width: 0%"></div>
                                </div>
                                <span id="planetModalMastery">0%</span>
                            </div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Problema MÃ¡s DifÃ­cil</div>
                            <div class="intel-value" id="planetModalWeakest">7 Ã— 8</div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Tasa de Ã‰xito</div>
                            <div class="intel-value" id="planetModalSuccess">65%</div>
                        </div>
                        <div class="intel-item">
                            <div class="intel-label">Batallas Ganadas</div>
                            <div class="intel-value" id="planetModalWins">23</div>
                        </div>
                    </div>
                </div>

                <div class="planet-reward-section">
                    <h3>ğŸ RECOMPENSA POR DOMINIO</h3>
                    <div class="reward-preview" id="planetModalReward">
                        <div class="reward-icon">ğŸ–ï¸</div>
                        <div class="reward-name">Casco de Cristal</div>
                    </div>
                </div>
            </div>

            <div class="planet-modal-footer">
                <button class="btn-primary btn-large" id="practicePlanetBtn">
                    Â¡Practicar la Tabla del <span id="practicePlanetTable">7</span>!
                </button>
            </div>
        </div>
    </div>

    <!-- Modal de Resultados -->
    <div id="resultsModal" class="modal hidden">
        <div class="modal-content">
            <div class="results-header">
                <div class="results-icon" id="resultsIcon">ğŸ‰</div>
                <h2 id="resultsTitle">Â¡IncreÃ­ble!</h2>
            </div>

            <div class="results-stats">
                <div class="result-stat">
                    <span class="result-label">PuntuaciÃ³n</span>
                    <span class="result-value" id="finalScore">0</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">Correctas</span>
                    <span class="result-value" id="finalCorrect">0</span>
                </div>
                <div class="result-stat">
                    <span class="result-label">PrecisiÃ³n</span>
                    <span class="result-value" id="finalAccuracy">0%</span>
                </div>
            </div>

            <div class="rewards-earned" id="rewardsEarned">
                <!-- Recompensas generadas dinÃ¡micamente -->
            </div>

            <div class="results-actions">
                <button class="btn-secondary" id="returnToMain">MenÃº Principal</button>
                <button class="btn-primary" id="playAgain">Â¡Jugar de Nuevo!</button>
            </div>
        </div>
    </div>

    <!-- Pantalla de Taladro RÃ¡pido -->
    <div id="speedDrillScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromSpeedDrill" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>âš¡ Taladro RÃ¡pido</h2>
            <div class="drill-progress">
                <span id="drillQuestionNumber">1</span> / <span id="drillTotalQuestions">20</span>
            </div>
        </div>

        <div class="drill-game">
            <!-- Pregunta Principal -->
            <div class="drill-question-container">
                <div class="drill-question" id="drillQuestion">7 Ã— 8 = </div>
                <div class="drill-answer">
                    <span class="drill-answer-value" id="drillAnswer">_</span>
                </div>
            </div>

            <!-- Feedback -->
            <div class="drill-feedback hidden" id="drillFeedback">Â¡Correcto!</div>

            <!-- Teclado NumÃ©rico (inyectado dinÃ¡micamente) -->

            <!-- Stats en Vivo -->
            <div class="drill-stats">
                <div class="drill-stat correct">
                    <div class="drill-stat-icon">âœ“</div>
                    <div class="drill-stat-value" id="drillCorrectCount">0</div>
                    <div class="drill-stat-label">Correctas</div>
                </div>
                <div class="drill-stat streak">
                    <div class="drill-stat-icon">ğŸ”¥</div>
                    <div class="drill-stat-value" id="drillStreak">0</div>
                    <div class="drill-stat-label">Racha</div>
                </div>
                <div class="drill-stat incorrect">
                    <div class="drill-stat-icon">âœ—</div>
                    <div class="drill-stat-value" id="drillIncorrectCount">0</div>
                    <div class="drill-stat-label">Incorrectas</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Defensa de la Nave -->
    <div id="shipDefenseScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromShipDefense" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>ğŸ›¸ Defensa de la Nave</h2>
            <div class="defense-stats-header">
                <div class="stat-pill">
                    <span class="stat-icon">â¤ï¸</span>
                    <span id="defenseLives">â¤ï¸â¤ï¸â¤ï¸</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-icon">â­</span>
                    <span id="defenseScore">0</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-icon">ğŸŒŠ</span>
                    Oleada <span id="defenseWave">1</span>
                </div>
            </div>
        </div>

        <div class="defense-game-area">
            <!-- InstrucciÃ³n -->
            <div class="defense-instruction">
                <h3 id="defenseTable">Tabla del 7</h3>
                <p class="defense-hint">ğŸ’¡ Haz clic en los mÃºltiplos. Deja pasar los demÃ¡s.</p>
            </div>

            <!-- Barra de progreso de oleada -->
            <div class="defense-wave-progress">
                <div class="defense-progress-bar">
                    <div class="defense-progress-fill" id="defenseProgress"></div>
                </div>
            </div>

            <!-- Ãrea de juego (asteroides caen aquÃ­) -->
            <div class="defense-space" id="asteroidsContainer">
                <!-- Los asteroides se generan dinÃ¡micamente -->
            </div>

            <!-- Nave del jugador (parte inferior) -->
            <div class="defense-ship-area">
                <div class="defense-ship" id="defenseShip">ğŸ›¸</div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Cadena de Factores -->
    <div id="factorChainScreen" class="screen">
        <div class="game-header">
            <button class="btn-back" id="backFromFactorChain" aria-label="Volver al menÃº principal">â† Volver</button>
            <h2>ğŸ§© Cadena de Factores</h2>
            <div class="factor-stats-header">
                <div class="stat-pill">
                    <span class="stat-icon">ğŸ¯</span>
                    Nivel <span id="factorLevel">1</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-icon">â­</span>
                    <span id="factorScore">0</span>
                </div>
                <div class="stat-pill">
                    <span class="stat-icon" id="factorHints">ğŸ’¡ğŸ’¡ğŸ’¡</span>
                </div>
            </div>
        </div>

        <div class="factor-game-area">
            <!-- InstrucciÃ³n -->
            <div class="factor-instruction">
                <h3>NÃºmero Objetivo: <span id="factorTarget">24</span></h3>
                <p class="factor-hint">ğŸ§© DescompÃ³n el nÃºmero en sus factores. Selecciona un divisor para factorizar.</p>
            </div>

            <!-- Cadena de factores -->
            <div class="factor-chain-display">
                <div class="chain-title">Tu Cadena de Factores:</div>
                <div class="factor-chain-container" id="factorChainContainer">
                    <!-- Los factores se generan dinÃ¡micamente -->
                </div>
            </div>

            <!-- Opciones de divisores -->
            <div class="divisor-selection">
                <div class="divisor-title">Selecciona un Divisor:</div>
                <div class="divisor-options" id="divisorOptions">
                    <!-- Los divisores se generan dinÃ¡micamente -->
                </div>
            </div>

            <!-- BotÃ³n de pista -->
            <div class="factor-actions">
                <button class="btn-hint" id="factorHintBtn">
                    ğŸ’¡ Usar Pista
                </button>
            </div>
        </div>
    </div>

    <!-- ================================ -->
    <!-- PANTALLAS DE MODO DESCUBRIMIENTO -->
    <!-- ================================ -->

    <!-- Pantalla 1: Intro - Truco MnemÃ³nico -->
    <div id="discoveryIntroScreen" class="screen discovery-screen">
        <div class="discovery-container">
            <div class="discovery-header">
                <h1 class="discovery-title">ğŸ§™â€â™‚ï¸ El Truco Secreto de la Tabla del 2</h1>
            </div>

            <div class="discovery-intro-content">
                <div class="discovery-mnemonic-section">
                    <div class="mnemonic-icon">âœ¨</div>
                    <p class="discovery-explanation">
                        <!-- Contenido dinÃ¡mico de TableDiscoveryEngine -->
                    </p>
                </div>

                <div class="discovery-examples">
                    <h3 class="examples-title">ğŸ“š Mira el PatrÃ³n:</h3>
                    <ul class="discovery-examples-list">
                        <!-- Lista dinÃ¡mica generada por TableDiscoveryEngine -->
                    </ul>
                </div>

                <div class="discovery-pattern">
                    <!-- PatrÃ³n visual completo generado dinÃ¡micamente -->
                </div>

                <div class="discovery-intro-actions">
                    <button class="btn-discovery-continue" id="discoveryIntroContinue">
                        âœ¨ ENTIENDO, Â¡PRACTICEMOS!
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla 2: Training - 10 Preguntas Secuenciales -->
    <div id="discoveryTrainingScreen" class="screen discovery-screen">
        <div class="discovery-container">
            <!-- Header con progreso -->
            <div class="discovery-training-header">
                <h2 class="training-title">ğŸ¯ Desbloquea el Cofre del 2</h2>
                <div class="discovery-progress">
                    <div class="discovery-progress-bar">
                        <!-- Estrellas generadas dinÃ¡micamente: â­â­â­âšªâšªâšªâšªâšªâšªâšª -->
                    </div>
                    <div class="discovery-progress-text">0/10</div>
                </div>
            </div>

            <!-- Mateo mini en esquina -->
            <div class="discovery-mateo-mini">
                ğŸ§™â€â™‚ï¸ Â¡TÃº puedes!
            </div>

            <!-- Ãrea de pregunta -->
            <div class="discovery-question-area">
                <div class="discovery-question">
                    <!-- Contenido dinÃ¡mico: 2 Ã— 4 = ? -->
                </div>

                <!-- Opciones de respuesta -->
                <div class="discovery-options">
                    <!-- Botones generados dinÃ¡micamente -->
                </div>

                <!-- Ãrea de ayuda -->
                <div class="discovery-help-container" style="display: none;">
                    <button class="discovery-help-btn">ğŸ’¡ VER AYUDA</button>
                    <p class="discovery-help-text" style="display: none;">
                        <!-- Texto de ayuda dinÃ¡mico: 2 + 2 + 2 + 2 = ? -->
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla 3: Reward - Recompensas -->
    <div id="discoveryRewardScreen" class="screen discovery-screen">
        <div class="discovery-container">
            <div class="discovery-reward-content">
                <!-- AnimaciÃ³n de cofre (CSS animation) -->
                <div class="reward-chest-animation">
                    <div class="reward-chest">ğŸ</div>
                </div>

                <h1 class="reward-title">ğŸŠ Â¡MISIÃ“N COMPLETADA! ğŸŠ</h1>
                <h2 class="reward-subtitle">ğŸ† TABLA DEL 2 DESBLOQUEADA</h2>

                <!-- EstadÃ­sticas de la sesiÃ³n -->
                <div class="reward-stats">
                    <!-- Contenido dinÃ¡mico:
                    <div class="stat-item">
                        <span class="stat-label">PrecisiÃ³n:</span>
                        <span class="stat-value">90%</span>
                    </div>
                    -->
                </div>

                <!-- Recompensas obtenidas -->
                <div class="reward-items-section">
                    <h3 class="reward-items-title">Has ganado:</h3>
                    <div class="reward-items">
                        <!-- Contenido dinÃ¡mico:
                        <div class="reward-item">
                            <span class="reward-icon">ğŸ¥ˆ</span>
                            <span class="reward-text">Medalla "Maestro del 2"</span>
                        </div>
                        -->
                    </div>
                </div>

                <!-- Acciones -->
                <div class="reward-actions">
                    <button class="btn-reward-practice reward-practice-btn">
                        ğŸ¯ PRACTICAR MÃS
                    </button>
                    <button class="btn-reward-map reward-map-btn">
                        ğŸ° VOLVER AL MAPA
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla: Grimorio de Trucos Secretos -->
    <div id="grimorioScreen" class="screen">
        <div class="grimorio-container">
            <!-- Header -->
            <div class="grimorio-header">
                <button class="btn-back" id="backFromGrimorio" aria-label="Volver al menÃº principal">â† Volver</button>
                <h1 class="grimorio-title">ğŸ“– Grimorio de Trucos Secretos</h1>
                <div class="grimorio-progress">
                    <span id="grimorioCollected">0</span> / <span id="grimorioTotal">9</span>
                </div>
            </div>

            <!-- Libro abierto -->
            <div class="grimorio-book">
                <!-- PÃ¡gina izquierda: Lista de trucos -->
                <div class="grimorio-page grimorio-page-left">
                    <h2 class="page-title">ğŸ“š Tablas Descubiertas</h2>
                    <div class="tricks-list" id="tricksList">
                        <!-- Generado dinÃ¡micamente -->
                    </div>
                </div>

                <!-- PÃ¡gina derecha: Detalle del truco seleccionado -->
                <div class="grimorio-page grimorio-page-right">
                    <div id="trickDetailContent">
                        <div class="trick-placeholder">
                            <div class="placeholder-icon">âœ¨</div>
                            <p>Selecciona una tabla de la izquierda para ver su truco secreto</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mensaje cuando no hay trucos -->
            <div class="grimorio-empty" id="grimorioEmpty" style="display: none;">
                <div class="empty-icon">ğŸ“­</div>
                <h2>Â¡Tu grimorio estÃ¡ vacÃ­o!</h2>
                <p>Descubre tus primeras tablas para coleccionar trucos mÃ¡gicos</p>
                <button class="btn-primary" id="startLearningFromGrimorio">
                    ğŸ“ COMENZAR A APRENDER
                </button>
            </div>
        </div>
    </div>

    <!-- Pantalla: Mapa del Castillo -->
    <div id="castleMapScreen" class="screen">
        <div class="castle-container">
            <!-- Header -->
            <div class="castle-header">
                <button class="btn-back" id="backFromCastle" aria-label="Volver al menÃº principal">â† Volver</button>
                <h1 class="castle-title">ğŸ° Tu Castillo de las Tablas</h1>
                <div class="castle-progress">
                    <span id="castleCompleted">0</span> / 9 pisos conquistados
                </div>
            </div>

            <!-- Castillo vertical con 9 pisos -->
            <div class="castle-tower" id="castleTower">
                <!-- Pisos generados dinÃ¡micamente de arriba (10) hacia abajo (2) -->
                <!-- Piso 9: Tabla del 10 (arriba) -->
                <!-- ... -->
                <!-- Piso 1: Tabla del 2 (abajo) -->
            </div>
        </div>
    </div>

    <!-- Pantalla: Modos Avanzados -->
    <div id="advancedModesScreen" class="screen">
        <div class="advanced-modes-container">
            <!-- Header -->
            <div class="advanced-modes-header">
                <button class="btn-back" id="backFromAdvancedModes" aria-label="Volver al menÃº principal">â† Volver</button>
                <h1 class="advanced-modes-title">ğŸ® Modos Avanzados</h1>
                <p class="advanced-modes-subtitle">DesafÃ­os especiales para expertos</p>
            </div>

            <!-- Grid de modos avanzados -->
            <div class="advanced-modes-grid">
                <!-- Los 6 modos se clonarÃ¡n aquÃ­ desde el DOM principal -->
            </div>
        </div>
    </div>

    <!-- Contenedor de PartÃ­culas -->
    <canvas id="particlesCanvas"></canvas>

    <!-- Mateo el Mago - Mascota -->
    <div id="mateoContainer" class="mateo-container" role="complementary" aria-label="Asistente Mateo el Mago" style="display: none;">
        <img id="mateoImage" src="assets/characters/mateo-happy.svg" alt="Mateo el Mago" class="mateo-character">
        <div id="mateoSpeech" class="mateo-speech" role="status" aria-live="polite" aria-atomic="true"></div>
    </div>

    <!-- BotÃ³n de toggle de sonido -->
    <button id="soundToggle" class="sound-toggle" aria-label="Activar o desactivar sonidos del juego">
        <span class="sound-icon" aria-hidden="true">ğŸ”Š</span>
    </button>

    <!-- Modal de DecisiÃ³n: Aprender vs Practicar -->
    <div id="learnOrPracticeModal" class="modal-overlay learn-practice-modal" style="display: none;">
        <div class="modal-content learn-practice-content">
            <!-- Mateo animado -->
            <div class="modal-mateo">
                <div class="mateo-avatar-large">ğŸ§™â€â™‚ï¸</div>
                <div class="mateo-speech-bubble">
                    <p id="learnPracticeModalMessage">Â¡Hola! Veo que quieres trabajar con la <strong>Tabla del <span id="modalTableNumber">2</span></strong>.</p>
                    <p>Â¿QuÃ© te gustarÃ­a hacer?</p>
                </div>
            </div>

            <!-- Opciones grandes -->
            <div class="learn-practice-options">
                <!-- OpciÃ³n 1: Aprender (Descubrir) -->
                <button class="learn-practice-btn learn-btn" id="btnLearnTable">
                    <div class="btn-icon">ğŸ“</div>
                    <div class="btn-content">
                        <h3>Â¡APRENDER!</h3>
                        <p>Descubre el truco secreto y practica paso a paso</p>
                    </div>
                    <div class="btn-badge">ğŸŒŸ NUEVO</div>
                </button>

                <!-- OpciÃ³n 2: Practicar -->
                <button class="learn-practice-btn practice-btn" id="btnPracticeTable">
                    <div class="btn-icon">âš¡</div>
                    <div class="btn-content">
                        <h3>Â¡PRACTICAR!</h3>
                        <p>Responde preguntas y mejora tu velocidad</p>
                    </div>
                </button>
            </div>

            <!-- BotÃ³n cerrar -->
            <button class="modal-close-btn" id="closeLearnPracticeModal">âœ•</button>
        </div>
    </div>

    <!-- Modal de Trucos MnemotÃ©cnicos -->
    <div id="trickModal" class="modal-overlay" style="display: none;">
        <div class="trick-modal-content">
            <button class="modal-close" id="closeTrickModal">âœ•</button>
            <div class="trick-header">
                <div class="trick-emoji" id="trickEmoji">ğŸ“š</div>
                <h2 id="trickTitle">Trucos para Recordar</h2>
            </div>
            <div class="trick-body" id="trickBody">
                <!-- Contenido dinÃ¡mico -->
            </div>
        </div>
    </div>

    <!-- Tutorial Interactivo -->
    <div id="tutorialOverlay" class="tutorial-overlay" style="display: none;">
        <div class="tutorial-backdrop"></div>
        <div class="tutorial-spotlight" id="tutorialSpotlight"></div>
        <div class="tutorial-content" id="tutorialContent">
            <div class="tutorial-box">
                <div class="tutorial-emoji" id="tutorialEmoji">âœ¨</div>
                <h3 class="tutorial-title" id="tutorialTitle">Â¡Bienvenido!</h3>
                <p class="tutorial-text" id="tutorialText">Te mostrarÃ© cÃ³mo usar Multiplicar MÃ¡gico</p>
                <div class="tutorial-buttons">
                    <button class="btn-tutorial-skip" id="tutorialSkip">Saltar</button>
                    <button class="btn-tutorial-next" id="tutorialNext">Siguiente</button>
                </div>
                <div class="tutorial-progress">
                    <span id="tutorialStep">1</span> de <span id="tutorialTotal">5</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ================================ -->
    <!-- NUEVA ARQUITECTURA MODULAR      -->
    <!-- ================================ -->

    <!-- Error Handling (Must load first) -->
    <script src="src/error/Logger.js"></script>
    <script src="src/error/ErrorBoundary.js"></script>
    <script src="src/error/GlobalErrorHandler.js"></script>
    <script src="src/error/RecoveryManager.js"></script>
    <script src="src/error/ErrorReporter.js"></script>

    <!-- Core Modules (Foundation) -->
    <script src="src/core/StorageManager.js"></script>
    <script src="src/core/EventBus.js"></script>
    <script src="src/core/GameStore.js"></script>

    <!-- Services (Business Logic) -->
    <script src="src/services/PlayerService.js"></script>
    <script src="src/services/AdaptiveService.js"></script>
    <script src="src/services/QuestionService.js"></script>
    <script src="src/services/AchievementService.js"></script>

    <!-- Controllers (Orchestration) -->
    <script src="src/controllers/GameController.js"></script>
    <script src="src/controllers/ScreenController.js"></script>
    <script src="src/controllers/ModeController.js"></script>

    <!-- Performance Modules (Optimization) -->
    <script src="src/performance/PerformanceMonitor.js"></script>
    <script src="src/performance/ModuleLoader.js"></script>
    <script src="src/performance/ResourceHints.js"></script>
    <script src="src/performance/AssetOptimizer.js"></script>
    <script src="src/performance/ServiceWorkerManager.js"></script>

    <!-- Accessibility Modules (Inclusive Design) -->
    <script src="src/accessibility/AccessibilityManager.js"></script>
    <script src="src/accessibility/AriaManager.js"></script>
    <script src="src/accessibility/KeyboardNavigationManager.js"></script>
    <script src="src/accessibility/ScreenReaderManager.js"></script>
    <script src="src/accessibility/VisualAccessibilityManager.js"></script>
    <script src="src/accessibility/AudioAccessibilityManager.js"></script>

    <!-- UX Research Modules (Data-Driven Optimization) -->
    <script src="src/ux/UserResearchManager.js"></script>
    <script src="src/ux/AnalyticsManager.js"></script>
    <script src="src/ux/ABTestingManager.js"></script>
    <script src="src/ux/FeedbackManager.js"></script>

    <!-- Game Modes (Discovery, Practice, etc) -->
    <script src="src/modes/TableDiscoveryEngine.js"></script>

    <!-- Systems (Medals, etc) -->
    <script src="src/systems/MedalsSystem.js"></script>

    <!-- Bootstrap (Initialization) -->
    <script src="src/Bootstrap.js"></script>

    <!-- ================================ -->
    <!-- SISTEMAS EXISTENTES              -->
    <!-- ================================ -->

    <script src="sounds.js"></script>
    <script src="mnemonicTricks.js"></script>
    <script src="mateo.js"></script>
    <script src="pauseMenu.js"></script>
    <script src="coinSystem.js"></script>
    <script src="feedbackSystem.js"></script>
    <script src="fireModeSystem.js"></script>
    <script src="shopSystem.js"></script>
    <script src="dailyMissionsSystem.js"></script>
    <script src="numericKeyboard.js"></script>
    <script src="speedDrillEngine.js"></script>
    <script src="shipDefenseEngine.js"></script>
    <script src="factorChainEngine.js"></script>
    <script src="rewardFlowSystem.js"></script>
    <script src="heroShowcaseSystem.js"></script>
    <script src="spaceGameEngine.js"></script>
    <script src="bossGameEngine.js"></script>
    <script src="practiceSystemEngine.js"></script>
    <script src="galaxySystemEngine.js"></script>
    <script src="app.js"></script>
</body>
</html>
